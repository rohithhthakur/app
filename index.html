from github import Github
import csv

# Initialize Github instance with your token
g = Github("your_github_access_token")

# Specify the organization name
org_name = 'your_org_name'
org = g.get_organization(org_name)

# Define a function to recursively search for Dockerfiles
def search_dockerfiles(repo, path=""):
    contents = repo.get_contents(path)
    for content in contents:
        if content.type == "dir":
            search_dockerfiles(repo, content.path)
        elif content.name == 'Dockerfile' and path:  # Ensure Dockerfile is not in the root
            writer.writerow([org_name, repo.name, content.path])

# Open a CSV file to write
with open('dockerfiles_in_subdirs.csv', mode='w', newline='') as file:
    writer = csv.writer(file)
    writer.writerow(['Organization', 'Repository', 'Dockerfile Location'])

    # Iterate through each repo in the organization
    for repo in org.get_repos():
        try:
            search_dockerfiles(repo)
        except Exception as e:
            print(f"Error processing {repo.name}: {str(e)}")

print("CSV file has been created.")



-----------------------------------------------


from github import Github
import csv

# Initialize Github instance with your token
g = Github("your_github_access_token")

# Specify the organization name
org_name = 'your_org_name'
org = g.get_organization(org_name)

# Open a CSV file to write
with open('repos_without_dockerfile_in_root.csv', mode='w', newline='') as file:
    writer = csv.writer(file)
    writer.writerow(['Organization', 'Repository', 'Has Dockerfile in Root'])

    # Iterate through each repo in the organization
    for repo in org.get_repos():
        try:
            # Get contents of the repository at the root directory
            contents = repo.get_contents("")
            # Check if there's a Dockerfile in the root directory
            dockerfile_in_root = any(item.name == 'Dockerfile' for item in contents)
            if not dockerfile_in_root:
                # If no Dockerfile in root, write to CSV
                writer.writerow([org_name, repo.name, 'No'])
        except Exception as e:
            print(f"Error processing {repo.name}: {str(e)}")
            continue

print("CSV file has been created.")