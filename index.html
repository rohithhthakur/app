import os
import json
import csv

# Define the directory path for 'dag_configs'
dag_configs_dir = 'dag_configs'

# Prepare lists to hold data for CSVs
csv_data_1 = []
csv_data_2 = []

# Loop through each folder in the dag_configs directory
for folder in os.listdir(dag_configs_dir):
    folder_path = os.path.join(dag_configs_dir, folder)
    if os.path.isdir(folder_path):
        # Loop through each file in the folder
        for filename in os.listdir(folder_path):
            if filename.endswith('.json'):
                with open(os.path.join(folder_path, filename), 'r') as file:
                    data = json.load(file)
                    # Extract the desired information if 'dataset_id' exists
                    if 'dataset_id' in data.get('parameters', {}).get('trans_code', {}):
                        dataset_id = data['parameters']['trans_code']['dataset_id']
                        # Append data for CSV 1
                        csv_data_1.append([folder, filename, 'trans_code', dataset_id])
                        # Prepare and add entry to CSV 2 if not already present
                        csv_entry_2 = [folder, 'trans_code', dataset_id]
                        if csv_entry_2 not in csv_data_2:
                            csv_data_2.append(csv_entry_2)

# Define CSV file names
csv_file_1 = 'config_details.csv'
csv_file_2 = 'unique_config_details.csv'

# Write data to CSV 1
with open(csv_file_1, mode='w', newline='') as file:
    writer = csv.writer(file)
    writer.writerow(['Folder Name', 'Filename', 'Inputconfig (trans_code)', 'Dataset ID'])
    writer.writerows(csv_data_1)

# Write data to CSV 2
with open(csv_file_2, mode='w', newline='') as file:
    writer = csv.writer(file)
    writer.writerow(['Folder Name', 'Inputconfig (trans_code)', 'Dataset ID'])
    writer.writerows(csv_data_2)

print(f"CSV files '{csv_file_1}' and '{csv_file_2}' have been created.")